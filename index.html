<!DOCTYPE html>
<html>
  <head>
    <title>WebPlayground Pro - Fresher Edition</title>
    <!-- Icons and Fonts -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      /* General Styles */
      body {
        margin: 0;
        font-family: "Segoe UI", sans-serif;
        background-color: #1e1e1e; /* Dark theme background */
        color: white;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
      }

      /* Top Navigation Bar */
      header {
        background-color: #2d2d2d;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #3d3d3d;
      }

      .project-name-input {
        background: transparent;
        color: white;
        border: 1px solid #444;
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 16px;
        font-weight: bold;
      }

      .header-buttons {
        display: flex;
        gap: 10px;
      }

      .btn {
        padding: 8px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: 0.2s;
      }

      .run-btn {
        background-color: #007acc;
        color: white;
      }
      .export-btn {
        background-color: #444;
        color: white;
      }
      .run-btn:hover {
        background-color: #005f99;
      }

      /* Workspace Layout */
      .workspace {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      /* Editor Section (Left Side) */
      .editor-side {
        width: 50%;
        display: flex;
        flex-direction: column;
        background-color: #1e1e1e;
      }

      /* Tab Buttons */
      .tabs {
        background-color: #2d2d2d;
        display: flex;
      }

      .tab-button {
        background: none;
        border: none;
        color: #aaa;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
      }

      .tab-button.active {
        background-color: #1e1e1e;
        color: #007acc;
        border-bottom: 2px solid #007acc;
      }

      /* Code Textareas */
      .textarea-container {
        flex: 1;
        position: relative;
      }

      textarea {
        width: 100%;
        height: 100%;
        background-color: #1e1e1e;
        color: #d4d4d4;
        padding: 20px;
        border: none;
        outline: none;
        font-family: "Consolas", "Monaco", monospace;
        font-size: 14px;
        resize: none;
        box-sizing: border-box;
        display: none; /* Hidden by default */
      }

      textarea.active {
        display: block; /* Show only the active one */
      }

      /* Resizer bar */
      .resizer {
        width: 5px;
        background-color: #333;
        cursor: col-resize;
      }
      .resizer:hover {
        background-color: #007acc;
      }

      /* Preview Section (Right Side) */
      .preview-side {
        flex: 1;
        display: flex;
        flex-direction: column;
        background-color: white;
      }

      iframe {
        flex: 1;
        border: none;
      }

      /* Console/Terminal Area */
      .console {
        height: 150px;
        background-color: #000;
        color: #0f0; /* Classic green terminal text */
        font-family: monospace;
        overflow-y: auto;
        border-top: 2px solid #333;
        padding: 10px;
      }

      .console-header {
        font-size: 10px;
        color: #666;
        margin-bottom: 5px;
        border-bottom: 1px solid #222;
        display: flex;
        justify-content: space-between;
      }

      .log-item {
        margin: 2px 0;
        border-bottom: 1px solid #111;
        padding-bottom: 2px;
      }
      .log-warn {
        color: #ffa500;
      }
      .log-error {
        color: #ff4444;
      }
    </style>
  </head>
  <body>
    <header>
      <div>
        <input
          type="text"
          id="project-name"
          class="project-name-input"
          value="My Web Project"
        />
      </div>
      <div class="header-buttons">
        <button class="btn export-btn" onclick="exportProject()">
          <i class="fas fa-download"></i> Export
        </button>
        <button class="btn run-btn" onclick="runCode()">
          <i class="fas fa-play"></i> Run Code
        </button>
      </div>
    </header>

    <div class="workspace">
      <!-- Editor Column -->
      <div class="editor-side" id="left-pane">
        <div class="tabs">
          <button
            id="btn-html"
            class="tab-button active"
            onclick="showTab('html')"
          >
            HTML
          </button>
          <button id="btn-css" class="tab-button" onclick="showTab('css')">
            CSS
          </button>
          <button id="btn-js" class="tab-button" onclick="showTab('js')">
            JS
          </button>
        </div>
        <div class="textarea-container">
          <textarea
            id="code-html"
            class="active"
            placeholder="Write HTML..."
          ></textarea>
          <textarea id="code-css" placeholder="Write CSS..."></textarea>
          <textarea id="code-js" placeholder="Write JavaScript..."></textarea>
        </div>
      </div>

      <!-- Resize Handle -->
      <div class="resizer" id="drag-handle"></div>

      <!-- Preview and Console Column -->
      <div class="preview-side">
        <iframe id="preview-window"></iframe>
        <div class="console" id="terminal">
          <div class="console-header">
            <span>VIRTUAL TERMINAL</span>
            <span onclick="clearConsole()" style="cursor: pointer">CLEAR</span>
          </div>
          <div id="log-container"></div>
        </div>
      </div>
    </div>

    <script>
      // Default boilerplate code
      var defaultHTML =
        "<h1>Hello!</h1>\n<p>Click the button to see a message.</p>\n<button onclick='sayHello()'>Click Me</button>";
      var defaultCSS =
        "body { text-align: center; padding-top: 50px; font-family: sans-serif; }\nh1 { color: #007acc; }";
      var defaultJS =
        "function sayHello() {\n  console.log('Button was clicked!');\n  console.warn('This is a warning log.');\n}";

      // Initialize variables
      var htmlEditor = document.getElementById("code-html");
      var cssEditor = document.getElementById("code-css");
      var jsEditor = document.getElementById("code-js");
      var logContainer = document.getElementById("log-container");

      // 1. Function to switch tabs
      function showTab(type) {
        // Remove active class from all buttons
        document
          .querySelectorAll(".tab-button")
          .forEach((btn) => btn.classList.remove("active"));
        // Add active class to clicked button
        document.getElementById("btn-" + type).classList.add("active");

        // Hide all textareas
        htmlEditor.classList.remove("active");
        cssEditor.classList.remove("active");
        jsEditor.classList.remove("active");
        // Show the selected one
        document.getElementById("code-" + type).classList.add("active");
      }

      // 2. Core function to run the code
      function runCode() {
        var html = htmlEditor.value;
        var css = "<style>" + cssEditor.value + "</style>";

        // This is the script we inject into the iframe to catch console logs
        var terminalBridge = `
                <script>
                    // Overriding console functions to send messages to the parent window
                    var oldLog = console.log;
                    console.log = function(message) {
                        oldLog(message);
                        window.parent.postMessage({type: 'log', content: message}, '*');
                    };
                    var oldWarn = console.warn;
                    console.warn = function(message) {
                        oldWarn(message);
                        window.parent.postMessage({type: 'warn', content: message}, '*');
                    };
                    window.onerror = function(err) {
                        window.parent.postMessage({type: 'error', content: err}, '*');
                    };
                <\/script>
            `;

        var js = "<script>" + jsEditor.value + "<\/script>";

        // Combine everything into one HTML string
        var fullOutput = html + css + terminalBridge + js;

        // Set it to the iframe
        var iframe = document.getElementById("preview-window");
        var doc = iframe.contentDocument || iframe.contentWindow.document;
        doc.open();
        doc.write(fullOutput);
        doc.close();
      }

      // 3. Listen for logs from the iframe
      window.onmessage = function (event) {
        if (event.data && event.data.type) {
          var newLog = document.createElement("div");
          newLog.className = "log-item log-" + event.data.type;
          newLog.innerText = "> " + event.data.content;
          logContainer.appendChild(newLog);
          document.getElementById("terminal").scrollTop =
            document.getElementById("terminal").scrollHeight;
        }
      };

      // 4. Export logic
      function exportProject() {
        var fileName = document.getElementById("project-name").value + ".html";
        var content =
          "<!DOCTYPE html><html><head><style>" +
          cssEditor.value +
          "</style></head><body>" +
          htmlEditor.value +
          "<script>" +
          jsEditor.value +
          "<\/script></body></html>";

        var blob = new Blob([content], { type: "text/html" });
        var url = URL.createObjectURL(blob);
        var link = document.createElement("a");
        link.href = url;
        link.download = fileName;
        link.click();
      }

      function clearConsole() {
        logContainer.innerHTML = "";
      }

      // 5. Draggable Resizer Logic
      var isResizing = false;
      var dragHandle = document.getElementById("drag-handle");
      var leftPane = document.getElementById("left-pane");

      dragHandle.onmousedown = function () {
        isResizing = true;
      };
      document.onmouseup = function () {
        isResizing = false;
      };
      document.onmousemove = function (e) {
        if (!isResizing) return;
        var offsetLeft = e.clientX;
        var widthPercent = (offsetLeft / window.innerWidth) * 100;
        if (widthPercent > 20 && widthPercent < 80) {
          leftPane.style.width = widthPercent + "%";
        }
      };

      // Set default values on load
      window.onload = function () {
        htmlEditor.value = defaultHTML;
        cssEditor.value = defaultCSS;
        jsEditor.value = defaultJS;
        runCode();
      };
    </script>
  </body>
</html>
